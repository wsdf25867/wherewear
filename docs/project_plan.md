# WhereWear 프로젝트 개발 계획

현재 `guidelines.md`와 프로젝트 구조를 확인해보니, 기본적인 **TPO 기반 AI 분석 기능**은 구현되어 있지만, 사용자 관리(로그인), 데이터 저장(옷장), 수익화 모델(광고/결제)을 위한 인프라는 아직 구축되지 않은 상태입니다.

요청하신 기능들을 단계별로 구현하기 위한 개발 계획을 제안해 드립니다.

---

### 1단계: 프로젝트 인프라 확장 (DB 및 보안 설정)
현재 `build.gradle.kts`에는 데이터베이스와 보안 관련 의존성이 없습니다. 소셜 로그인과 옷장 기능을 위해 이를 먼저 추가해야 합니다.

*   **데이터베이스 도입:**
    *   사용자 정보와 분석된 옷장 데이터를 저장하기 위해 RDBMS가 필요합니다.
    *   **추천:** MySQL 또는 PostgreSQL (개발 단계에서는 H2 사용 가능).
    *   **JPA 추가:** `spring-boot-starter-data-jpa`를 추가하여 엔티티 관리를 쉽게 합니다.
*   **보안 및 인증 (소셜 로그인):**
    *   **Spring Security & OAuth2 Client** 추가 (`spring-boot-starter-oauth2-client`).
    *   **지원 범위:** 카카오, 구글, 네이버 (한국 사용자 대상 필수).
    *   **인증 방식:** 소셜 로그인 후 서버에서 자체 JWT(Access/Refresh Token)를 발급하여 앱 내 인증을 유지하는 방식을 추천합니다.

### 2단계: 소셜 로그인 및 사용자 관리 구현
사용자를 식별해야 "나만의 옷장"과 "결제 내역"을 관리할 수 있습니다.

*   **User 엔티티 설계:**
    *   `id`: PK
    *   `provider`: (kakao, google, naver)
    *   `providerId`: 소셜 서비스의 고유 ID
    *   `credits`: 보유한 유료 분석권 개수 (100원 결제 시 증가)
*   **로그인 흐름:**
    1.  앱에서 소셜 로그인 버튼 클릭 -> 인가 코드 발급.
    2.  백엔드로 인가 코드 전달 -> 백엔드가 소셜 서버에서 사용자 정보 획득.
    3.  DB 조회 후 신규 가입이면 저장, 기존 회원이면 로그인 처리.
    4.  앱에 JWT 토큰 반환.

### 3단계: 디지털 옷장 및 의류 메타데이터 관리 구현
AI 분석 결과를 "평가(Analysis)"와 "의류 정보(Clothing Metadata)"로 분리하여 저장 및 관리합니다.

*   **데이터 모델 설계 (엔티티):**
    *   **OutfitAnalysis (분석 이력):**
        *   `id`: PK
        *   `user_id`: User FK
        *   `imageUrl`: 업로드한 이미지 경로
        *   `score`: 점수
        *   `advice`: 조언
        *   `createdAt`: 생성일
    *   **Cloth (의류 아이템):**
        *   `id`: PK
        *   `category`: 종류 (상의, 하의, 신발 등)
        *   `color`: 색상
        *   `material`: 소재
        *   `brand`: 브랜드 (식별 가능 시)
    *   **Wardrobe (유저-의류 매핑):**
        *   유저가 소유한 `Cloth` 목록을 관리
*   **AI 응답 구조 개선:**
    *   `AnalysisResult`: TPO 점수, 피드백, 조언
    *   `DetectedItems`: 감지된 의류 리스트 (카테고리, 색상, 특징 등) -> **새로운 데이터면 추가, 기존 데이터면 매핑**
*   **API 변경 및 추가:**
    *   `POST /api/v1/analyze`: (변경) 분석 후 결과 반환 + 의류 정보 추출.
    *   `POST /api/v1/wardrobe`: (신규) 추출된 의류 정보를 사용자 옷장에 등록 (분석 후 자동 등록되거나 사용자 확정 시 등록).
    *   `GET /api/v1/wardrobe`: 사용자의 옷장(보유 의류) 조회.
    *   `GET /api/v1/analysis-history`: 과거 분석 이력 조회.
*   **캐싱 전략:**
    *   자주 등장하는 의류 메타데이터(예: "흰색 면 티셔츠")는 캐시(Redis 등)에 저장하여, 매번 새로 생성하지 않고 재사용하거나 빠르게 매칭합니다.

### 4단계: 수익화 모델 (광고 vs 100원 결제) 구현
무료(광고 시청)와 유료(직접 결제) 로직을 분리합니다.

*   **비즈니스 로직 설계:**
    *   **광고 시청 (무료):**
        *   클라이언트(앱)에서 전면 광고(Reward Ad) 시청 완료 시, 백엔드 분석 요청 헤더에 `ad-viewed-token` 같은 증명 값을 보냅니다. (초기엔 단순히 클라를 믿고 구현, 추후 검증 로직 강화)
        *   또는 광고 시청 완료 시 서버로 이벤트를 보내 **1회용 무료 쿠폰**을 지급하는 방식도 가능합니다.
    *   **100원 결제 (유료):**
        *   PG사 연동 (PortOne, Toss Payments 등)을 통해 100원 결제.
        *   결제 성공 웹훅(Webhook) 수신 시 해당 유저의 `credits` +1.
    *   **분석 요청 시:**
        *   보유 `credits`가 있는지 확인 -> 있으면 1 차감 후 분석.
        *   없으면 에러 반환 (클라이언트는 이때 광고를 띄우거나 결제 유도).

---

### 추가 기능 아이디어 제안
앱의 완성도와 리텐션을 높이기 위한 추가 기능입니다.

1.  **날씨 API 연동 (자동 TPO):**
    *   매번 "여름 낮 2시"를 입력하는 것은 번거롭습니다.
    *   사용자 위치(GPS)를 기반으로 **현재 날씨와 기온**을 자동으로 TPO의 `time`(날씨) 정보로 채워주면 UX가 훨씬 좋아집니다.
2.  **OOTD 랭킹 (익명 공유):**
    *   "오늘의 베스트 드레서" 게시판.
    *   분석 점수가 높은 코디를 익명으로 자랑하고, 다른 사용자에게 '좋아요'를 받는 기능.
3.  **스타일 통계 (월간 리포트):**
    *   디지털 옷장에 쌓인 데이터를 기반으로 통계를 제공합니다.
    *   "이번 달은 '하객룩'을 가장 많이 입으셨네요!"
    *   "검정색 옷 비중이 70%입니다. 밝은 색을 시도해보세요."
4.  **쇼핑몰 연동 (수익화 강화):**
    *   AI 조언이 "넥타이 색이 아쉽네요"라면, 어울리는 넥타이 쇼핑 링크를 추천해줍니다. (제휴 링크)

### 개발 우선순위 (Roadmap)
1.  **DB & JPA 설정**: 프로젝트의 허리 만들기
2.  **소셜 로그인**: 사용자 식별 시작
3.  **옷장 및 의류 데이터 구현**: 핵심 데이터 구조화 및 저장
4.  **S3 이미지 업로드**: 실제 서비스용 이미지 호스팅
5.  **결제/광고 로직**: 수익화 연결
